<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ÙƒØ´Ù Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <nav>
        <a href="/">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="/chatbot">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ</a>
        <a href="/detection">ÙƒØ´Ù Ø§Ù„Ø£Ù…Ø±Ø§Ø¶</a>
    </nav>

    <div class="container">
        <h1>ğŸ§ª ÙƒØ´Ù Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù†Ø¨Ø§Øª</h1>
        <form id="detectForm" enctype="multipart/form-data">
            <input type="file" name="file" id="fileInput" required>
            <button type="submit">ØªØ´Ø®ÙŠØµ</button>
        </form>

        <div id="imagePreview"></div>
        <div id="resultBox"></div>
        <div id="treatmentBox"></div>
    </div>

    <script>
        document.getElementById("detectForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù
            const fileInput = document.getElementById("fileInput");
            if (!fileInput.files[0]) {
                alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹");
                return;
            }

            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            document.getElementById("resultBox").innerHTML = `<h3>â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</h3><p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</p>`;
            document.getElementById("treatmentBox").innerHTML = "";
            document.getElementById("imagePreview").innerHTML = "";

            try {
                const formData = new FormData();
                formData.append("file", fileInput.files[0]);

                const response = await fetch("/api/predict", {
                    method: "POST",
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

            const data = await response.json();

            if (data.error) {
                document.getElementById("resultBox").innerHTML = `<h3>âŒ Ø®Ø·Ø£:</h3><p>${data.error}</p>`;
                return;
            }

            // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©
            if (data.image_url) {
                document.getElementById("imagePreview").innerHTML = `<img src="${data.image_url}" style="max-width: 400px; border-radius: 8px;">`;
            }

            // Ø§Ù„Ø£Ù…Ø±Ø§Ø¶
            let diseasesText = "Ù„Ù… ÙŠØªÙ… Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø£Ù…Ø±Ø§Ø¶.";
            if (data.diseases && data.diseases.length > 0) {
                diseasesText = data.diseases.join(", ");
            }
            document.getElementById("resultBox").innerHTML = `<h3>ğŸŒ± Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…ÙƒØªØ´ÙØ©:</h3><p>${diseasesText}</p>`;

            // Ø§Ù„Ø¹Ù„Ø§Ø¬
            const treatment = data.treatment || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù„Ø§Ø¬ Ù…ØªØ§Ø­.";
            document.getElementById("treatmentBox").innerHTML = `<h3>ğŸ’Š Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù…Ù‚ØªØ±Ø­:</h3><p style="line-height: 1.6;">${treatment}</p>`;

            } catch (error) {
                console.error("Error:", error);
                document.getElementById("resultBox").innerHTML = `<h3>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:</h3><p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>`;
                document.getElementById("treatmentBox").innerHTML = "";
            }
        });
    </script>
</body>
</html>
